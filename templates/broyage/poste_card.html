<!-- üß≠ Titre principal -->
{% comment %} <div class="text-center bg-primary text-white py-3 rounded shadow-sm mb-4 fs-4 fw-bold">üõ†Ô∏è Broyage du {{ search_date }}</div> {% endcomment %}

<div class="
{% if poste == '06H-18H' or poste == '18H-06H' %}
  col-md-6
{% elif poste == '06H-14H' or poste == '14H-22H' or poste == '22H-06H' %} 
  col-md-4
{% endif %}
  ">
  <div class="card border-0 shadow-lg rounded-4 overflow-hidden h-100 hover-shadow">
    <div class="card-header bg-{{ couleur }} text-white text-center fs-5">üïí Poste {{ poste }}</div>
    <div class="card-body table-responsive p-0">
      <!-- üî¢ Tableau Totaliseur -->
      <table class="table table-bordered table-sm mb-0 text-center align-middle">
        <thead class="table-light">
          <tr>
            <th colspan="3">TOTALISEUR</th>
            <th>ACTION</th>
          </tr>
          <tr class="text-muted small">
            <td>CLINKER</td>
            <td>GYPSE</td>
            <td>DOLOMITE</td>
            <td></td>
          </tr>
        </thead>
        <tbody>
          {% if object_tot %}
            {% for t in object_tot %}
              <tr>
                <td>{{ t.clinker_debut|floatformat:0 }}</td>
                <td>{{ t.gypse_debut|floatformat:0 }}</td>
                <td>{{ t.dolomite_debut|floatformat:0 }}</td>
                <td>
                  {% if user.is_authenticated and user.profil.poste == 'broyage' or user.profil.role == 'admin' %}
                    <a href="{% url 'broyage:update-totaliseur' t.slug %}" class="text-warning"><i class="fas fa-pen"></i></a>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="3" class="text-muted">‚Äî</td>
              <td>
                {% if user.is_authenticated and user.profil.poste == 'broyage' or user.profil.role == 'admin' %}
                  <a href="{% url 'broyage:ajout-totalisuer' %}" class="text-success"><i class="fas fa-plus-circle"></i></a>
                {% endif %}
              </td>
            </tr>
          {% endif %}

          <!-- ‚öôÔ∏è Bloc BROYAGE -->
          {% if object_post %}
            {% for o in object_post %}
              <tr>
                <td>{{ o.clinker_fin|floatformat:0 }}</td>
                <td>{{ o.gypse_fin|floatformat:0 }}</td>
                <td>{{ o.dolomite_fin|floatformat:0 }}</td>
                <td>
                  {% if user.is_authenticated and user.profil.poste == 'broyage' or user.profil.role == 'admin' %}
                    <a href="{% url 'broyage:update-broyage' o.slug %}" class="text-warning"><i class="fas fa-pen"></i></a>
                  {% endif %}
                </td>
              </tr>
              <tr class="table-secondary small">
                <td>{{ o.dif_clinker|floatformat:0 }}</td>
                <td>{{ o.dif_gypse|floatformat:0 }}</td>
                <td>{{ o.dif_dolomite|floatformat:0 }}</td>
                <td></td>
              </tr>
              <tr class="table-light fw-semibold">
                <td colspan="4">üßÆ Totaliseur : {{ o.compt_fin|floatformat:0 }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="3">‚Äî</td>
              <td>
                {% for iteam in object_tot %}
                  {% if user.is_authenticated and user.profil.poste == 'broyage' or user.profil.role == 'admin' %}
                    <a href="{% url 'broyage:ajout-broyage' iteam.slug %}" class="text-success"><i class="fas fa-circle-plus"></i></a>
                  {% endif %}
                {% endfor %}
              </td>
            </tr>
          {% endif %}

          <!-- ‚ö° Indicateurs Production -->
          {% for prod in object_broy %}
            {% if prod.post.post == poste %}
              <tr class="mt-3">
                <td colspan="2" class="mb-1 fs-6">
                  <strong>Prod :</strong>
                </td>
                <td>{{ prod.prod }}</td>
                <td>
                  <span class="text-muted small">Ton</span>
                </td>
              </tr>
              <tr>
                <td colspan="2" class="mb-1 fs-6">
                  <strong>R :</strong>
                </td>
                <td>{{ prod.rend }}</td>
                <td>
                  <span class="text-muted small">Ton/Hr</span>
                </td>
              </tr>
              <tr>
                <td colspan="2" class="mb-1 fs-6">
                  <strong>C.S :</strong>
                </td>
                <td>{{ prod.cons }}</td>
                <td>
                  <span class="text-muted small">KwH/T</span>
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>

      <!-- üîß Bouton panne -->
      <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded-bottom-4">
        <div class="fw-bold text-{{ couleur }}">
          {% for iteam in object_broy %}
            {% if iteam.post.post == poste %}
              ‚è±Ô∏è TM : {{ iteam.temp_march }}
            {% endif %}
          {% endfor %}
        </div>
        <div class="fw-bold text-{{ couleur }}">
          {% for iteam in object_broy %}
            {% if iteam.post.post == poste %}
              {{ iteam.user }}
            {% endif %}
          {% endfor %}
        </div>

        {% for o in object_broy %}
          {% if o.post.post == poste %}
            {% if user.is_authenticated and user.profil.poste == 'broyage' or user.profil.role == 'admin' %}
              <a href="{% url 'broyage:ajout-broyage-panne' o.slug %}" class="btn btn-outline-{{ couleur }} btn-sm rounded-pill shadow-sm">‚ûï Panne</a>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>

<!-- üßØ Tableau des Pannes -->
{% comment %} <div class="card shadow-lg border-0 mt-5">
  <div class="card-header bg-danger text-white text-center fs-5">‚õî Arr√™ts du Broyeur</div>
  <div class="card-body table-responsive">
    <table class="table table-hover table-bordered table-sm text-center align-middle">
      <thead class="bg-info text-white text-uppercase">
        <tr>
          <th>Poste</th>
          <th>D√©but</th>
          <th>Fin</th>
          <th>Dur√©e</th>
          <th>D√©partement</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {% for iteam in object_pann %}
          <tr>
            <td class="fw-bold text-primary">{{ iteam.broyage.title }}</td>
            <td>{{ iteam.start_panne }}</td>
            <td>{{ iteam.end_panne }}</td>
            <td>{{ iteam.duree_formatee }}</td>
            <td>{{ iteam.departement }}</td>
            <td class="text-start">{{ iteam.description }}</td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-muted fst-italic">Aucune panne enregistr√©e</td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot class="table-info text-uppercase">
        <tr>
          <th colspan="3" class="text-end">Total de temps d'arr√™t :</th>
          <th colspan="3">{{ total_temp_arret }}</th>
        </tr>
      </tfoot>
    </table>
  </div>
</div> {% endcomment %}
